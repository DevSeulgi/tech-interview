# 프로세스 동기화

## 프로세스 동기화란
- 프로세스는 서로 메세지를 보내고 프로세스 내부에서는 쓰레드끼리 자원을 공유하면서 '동기화'에 대한 문제가 항상 발생할 수 있다. 
- 즉 공유된 자원(공유자원)에 여러 프로세스, 여러 쓰레드가 동시에 접근하면서 문제가 발생하게 된다. 
- 공유자원: 시스템 안에서 각 프로세스, 스레드가 함께 접근할 수 있는 모니터, 프린터, 메모리, 파일, 데이터 등의 자원이나 변수 등을 의미한다.
- 이 공유자원을 두 개 이상의 프로세스가 동시에 읽거나 쓰는 상황을 경쟁상태(race condition)라고 한다. 동시에 접근을 시도할 때 접근의 타이밍이나 순서 등이 결괏값에 영향을 줄 수 있는 상태이다.
- 임계영역: 둘 이상의 프로세스 또는 스레드가 공유자원에 접근할 때 순서등의 이유로 결과가 달라지는 코드 영역을 말한다.
- 임계영역을 해결하기 위해 크게 뮤텍스(Mutex), 세마포어(Semaphore), 모니터(Monitor) 등의 방법이 있다. 이 방법들은 모두 상호 배제, 한정 대기, 융통성이란 조건을 만족한다.
  - 상호 배제: 한 프로세스가 임계 영역에 들어갔을 때 다른 프로세스는 들어갈 수 없다.
  - 한정 대기: 특정 프로세스가 영원히 임계 영역에 들어가지 못하면 안 된다.
  - 융통성: 한 프로세스가 다른 프로세스의 일을 방해해서는 안 된다.

## 뮤텍스(Mutex), 세마포어(Semaphore), 모니터(Monitor)
- 뮤텍스는 스레드가 공유자원을 잠금(lock)하고 사용한 후 사용이 끝나면 잠금을 해제(unlock)하는 방식으로 동기화를 구현하는 객체이다.
- 뮤텍스는 잠금 또는 잠금해제라는 상태만을 가진다.
- 세마포어는 일반화된 뮤텍스이다. 간단한 정수 값과 두 가지 함수(wait, signal)로 구현된다.
- wait()는 자신의 차례가 올 때까지 기다리는 함수이며 signal()은 다음 프로세스로 순서를 넘겨주는 함수이다.
- 프로세스가 공유 자원에 접근하면 세마포어에서 wait()작업을 수행하고 프로세스가 공유자원을 해제하면 세마포어에서 signal() 작업을 수행한다.
- 세마포어는 조건 변수가 없고 프로세스가 세마포어 값을 수정할 때 다른 프로세스는 동시에 세마포어 값을 수정할 수 없다.
- 뮤텍스는 한 개의 프로세스 또는 스레드 만의 임계영역 접근을 처리하지만 세마포어는 여러 개의 임계영역 접근을 처리할 수 있다.
- 모니터는 둘 이상의 스레드나 프로세스가 공유자원에 안전하게 접근할 수 있도록 공유자원을 숨기고 해달 접근에 대해 인터페이스만 제공한다.
- 모니터는 모니터 큐를 통해 공유자원에 대한 작업들을 순차적으로 처리한다.
- 모니터는 세마포어보다 구현하기 쉬우며 모니터에서 상호 배제는 자동인 반면 세마포어에선 상호 배제를 명시적으로 구현해야 하는 차이점이 있다.

## 교착상태(Deadlock)
- 두 개 이상의 프로세스들이 서로가 가진 자원을 기다리며 중단된 상태를 말한다.
- 예를 들어 프로세스 A가 프로세스 B의 어떤 자원을 요청할 때 프로세스 B도 프로세스 A가 점유하고 있는 자원을 요청하는 상황이 이에 해당한다.
- 교착상태의 원인: 상호 배제, 점유 대기, 비선점, 환형 대기